# Default values for ldap-openfga-sync.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

replicaCount: 1

image:
  repository: ghcr.io/agdsn/ldap-openfga-sync
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Automatically mount a ServiceAccount's API credentials?
  automount: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext:
  runAsNonRoot: true
  runAsUser: 1000
  fsGroup: 1000

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false

resources:
  limits:
    cpu: 500m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

# Existing secret containing sensitive values
# If not set, a secret will be created from the values below
# Expected keys in secret:
#   LDAP_BIND_PASSWORD
#   OPENFGA_STORE_ID
#   OPENFGA_API_TOKEN (optional)
existingSecret: ""

# LDAP Configuration
ldap:
  server: "ldap://ldap.example.com:389"
  bindDn: "cn=admin,dc=example,dc=com"
  bindPassword: ""
  groupBaseDn: "ou=groups,dc=example,dc=com"
  groupFilter: "(objectClass=groupOfNames)"
  memberAttribute: "member"
  useTls: false
  # Custom CA certificate for LDAP TLS verification
  # Provide either caCert (inline) or existingCaCertSecret
  caCert: ""
  # Reference to existing secret containing CA certificate
  # Expected key: ca.crt
  existingCaCertSecret: ""

# OpenFGA Configuration
openfga:
  apiUrl: "http://openfga:8080"
  storeId: ""
  apiToken: ""
  authorizationModelId: ""

# Sync Configuration
sync:
  dryRun: false
  # Sync interval in seconds (default: 21600 = 6 hours)
  intervalSeconds: 21600
  # List of groups to sync from LDAP to OpenFGA
  # Only these groups will be synchronized
  groups: []
  # Example:
  # groups:
  #   - developers
  #   - operations
  #   - managers

# Liveness and readiness probes
livenessProbe:
  enabled: true
  exec:
    command:
      - pgrep
      - -f
      - entrypoint.sh
  initialDelaySeconds: 30
  periodSeconds: 3600
  timeoutSeconds: 10
  failureThreshold: 3

readinessProbe:
  enabled: true
  exec:
    command:
      - pgrep
      - -f
      - entrypoint.sh
  initialDelaySeconds: 10
  periodSeconds: 60
  timeoutSeconds: 5
  failureThreshold: 3

nodeSelector: {}

tolerations: []

affinity: {}

